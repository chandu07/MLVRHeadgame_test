<!DOCTYPE html>
<html lang="en">
  <head>
    <title>three.js webgl - lights - point lights</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style>
      body {
        background-color: #000;
        margin: 0px;
        overflow: hidden;
      }
      #info {
        position: absolute;
        top: 0px; width: 100%;
        color: #ffffff;
        padding: 5px;
        font-family: Monospace;
        font-size: 13px;
        text-align: center;
      }
      a {
        color: #ff0080;
        text-decoration: none;
      }
      a:hover {
        color: #0080ff;
      }
    </style>
  </head>
  <body>
    <div id="container"></div>
    <script src="js/three.js"></script>
    <script src="js/headtrackr.js"></script>
    <script src="js/Detector.js"></script>
    <script src="js/TrackballControls.js"></script>
    <!--<script src="js/libs/stats.min.js"></script>-->

    <canvas id="compare" width="320" height="240" style="display:none"></canvas>
    <video id="vid" autoplay="" loop="" src="blob:https://www.auduno.com/38a201b5-ca21-4c44-810b-1de2f47aed83" width="320" height="240" style="position: absolute; top: 50px; z-index: 100001; display: none;"></video>

    <script>
      if ( ! Detector.webgl ) Detector.addGetWebGLMessage();
      var camera, scene, renderer, controls;
      var light1, light2, light3, light4, light5, light6;
      var clock = new THREE.Clock();
      var videoInput = document.getElementById('vid');
      var canvasInput = document.getElementById('compare');
      // var stats;
      function init() {
        var container = document.getElementById( 'container' );
        // CAMERA
        camera = new THREE.PerspectiveCamera( 50, window.innerWidth / window.innerHeight, 1, 300 );
        camera.position.set( 0, 15, 150 );
        camera.lookAt( new THREE.Vector3() );
        // SCENE
        scene = new THREE.Scene();
        scene.background = new THREE.Color( 0x040306 );
        scene.fog = new THREE.Fog( 0x040306, 10, 300 );
        // CONTROLS
        controls = new THREE.TrackballControls( camera );
        controls.rotateSpeed = 1.0;
        controls.zoomSpeed = 1.2;
        controls.panSpeed = 0.8;
        controls.noZoom = false;
        controls.noPan = false;
        controls.staticMoving = false;
        controls.dynamicDampingFactor = 0.15;
        controls.keys = [ 65, 83, 68 ];
        // TEXTURES
        var textureLoader = new THREE.TextureLoader();
        var texture = textureLoader.load( "textures/disturb.jpg" );
        texture.repeat.set( 20, 10 );
        texture.wrapS = texture.wrapT = THREE.RepeatWrapping;
        texture.format = THREE.RGBFormat;
        // MATERIALS
        var groundMaterial = new THREE.MeshPhongMaterial( { color: 0xffffff, map: texture } );
        var objectMaterial = new THREE.MeshStandardMaterial( { color: 0xffffff, roughness: 0.5, metalness: 1.0 } );
        // GROUND
        var mesh = new THREE.Mesh( new THREE.PlaneBufferGeometry( 800, 400, 2, 2 ), groundMaterial );
        mesh.position.y = - 5;
        mesh.rotation.x = - Math.PI / 2;
        scene.add( mesh );
        // OBJECTS
        var objectGeometry = new THREE.TorusBufferGeometry( 1.5, 0.4, 8, 16 );
        for ( var i = 0; i < 5000; i ++ ) {
          var mesh = new THREE.Mesh( objectGeometry, objectMaterial );
          mesh.position.x = 400 * ( 0.5 - Math.random() );
          mesh.position.y = 50 * ( 0.5 - Math.random() ) + 25;
          mesh.position.z = 200 * ( 0.5 - Math.random() );
          mesh.rotation.y = 3.14 * ( 0.5 - Math.random() );
          mesh.rotation.x = 3.14 * ( 0.5 - Math.random() );
          mesh.matrixAutoUpdate = false;
          mesh.updateMatrix();
          scene.add( mesh );
        }
        // LIGHTS
        var intensity = 2.5;
        var distance = 100;
        var decay = 2.0;
        var c1 = 0xff0040, c2 = 0x0040ff, c3 = 0x80ff80, c4 = 0xffaa00, c5 = 0x00ffaa, c6 = 0xff1100;
        var sphere = new THREE.SphereBufferGeometry( 0.25, 16, 8 );
        light1 = new THREE.PointLight( c1, intensity, distance, decay );
        light1.add( new THREE.Mesh( sphere, new THREE.MeshBasicMaterial( { color: c1 } ) ) );
        scene.add( light1 );
        light2 = new THREE.PointLight( c2, intensity, distance, decay );
        light2.add( new THREE.Mesh( sphere, new THREE.MeshBasicMaterial( { color: c2 } ) ) );
        scene.add( light2 );
        light3 = new THREE.PointLight( c3, intensity, distance, decay );
        light3.add( new THREE.Mesh( sphere, new THREE.MeshBasicMaterial( { color: c3 } ) ) );
        scene.add( light3 );
        light4 = new THREE.PointLight( c4, intensity, distance, decay );
        light4.add( new THREE.Mesh( sphere, new THREE.MeshBasicMaterial( { color: c4 } ) ) );
        scene.add( light4 );
        light5 = new THREE.PointLight( c5, intensity, distance, decay );
        light5.add( new THREE.Mesh( sphere, new THREE.MeshBasicMaterial( { color: c5 } ) ) );
        scene.add( light5 );
        light6 = new THREE.PointLight( c6, intensity, distance, decay );
        light6.add( new THREE.Mesh( sphere, new THREE.MeshBasicMaterial( { color: c6 } ) ) );
        scene.add( light6 );
        var dlight = new THREE.DirectionalLight( 0xffffff, 0.05 );
        dlight.position.set( 0.5, 1, 0 ).normalize();
        scene.add( dlight );
        // RENDERER
        renderer = new THREE.WebGLRenderer( { antialias: true } );
        renderer.setPixelRatio( window.devicePixelRatio );
        renderer.setSize( window.innerWidth, window.innerHeight );
        container.appendChild( renderer.domElement );
        renderer.gammaInput = true;
        renderer.gammaOutput = true;
        // STATS
        // stats = new Stats();
        // container.appendChild( stats.dom );
        //
        window.addEventListener( 'resize', onWindowResize, false );
        window.addEventListener( 'facetrackingEvent', facetracking_Event, false );
      }
      function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize( window.innerWidth, window.innerHeight );
        controls.handleResize();
      }

      function facetracking_Event(event) {
        if (event.detection == "CS") {
          camera.lookAt = new THREE.Vector3(event.x, event.y, 50);
      }}

      // headtrackr.controllers.three.realisticAbsoluteCameraControl(camera, 27, [0,0,50], new THREE.Vector3(0,0,0), {damping : 0.5});

      var htracker = new headtrackr.Tracker({altVideo : {ogv : "./media/capture5.ogv", mp4 : "./media/capture5.mp4"}});
      htracker.init(videoInput, canvasInput);
      htracker.start();

      init();
      animate();
      //

      // document.addEventListener("facetrackingEvent", function( event ) {
      //   // clear canvas
      //   // overlayContext.clearRect(0,0,320,240);
      //   // once we have stable tracking, draw rectangle
      //   if (event.detection == "CS") {
      //     controls.target = new THREE.Vector3(200, 150, 50);
      //     // camera.position.x = event.x*4;
      //     // camera.position.y = event.y*4;
      //     // requestAnimationFrame( animate );
      //     // render();
      //     // overlayContext.translate(event.x, event.y)
      //     // overlayContext.rotate(event.angle-(Math.PI/2));
      //     // overlayContext.strokeStyle = "#00CC00";
      //     // overlayContext.strokeRect((-(event.width/2)) >> 0, (-(event.height/2)) >> 0, event.width, event.height);
      //     // overlayContext.rotate((Math.PI/2)-event.angle);
      //     // overlayContext.translate(-event.x, -event.y);
      //   }
      // });

      function animate() {
        requestAnimationFrame( animate );
        render();
        // stats.update();
      }
      function render() {
        var time = Date.now() * 0.00025;
        var z = 20, d = 150;
        light1.position.x = Math.sin( time * 0.7 ) * d;
        light1.position.z = Math.cos( time * 0.3 ) * d;
        light2.position.x = Math.cos( time * 0.3 ) * d;
        light2.position.z = Math.sin( time * 0.7 ) * d;
        light3.position.x = Math.sin( time * 0.7 ) * d;
        light3.position.z = Math.sin( time * 0.5 ) * d;
        light4.position.x = Math.sin( time * 0.3 ) * d;
        light4.position.z = Math.sin( time * 0.5 ) * d;
        light5.position.x = Math.cos( time * 0.3 ) * d;
        light5.position.z = Math.sin( time * 0.5 ) * d;
        light6.position.x = Math.cos( time * 0.7 ) * d;
        light6.position.z = Math.cos( time * 0.5 ) * d;
        controls.update( clock.getDelta() );
        renderer.render( scene, camera );
      }
    </script>
  </body>
</html>
